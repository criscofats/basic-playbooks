---
 - name: Gather guest info on host 
   become: false
   hosts: localhost
   gather_facts: true

   tasks:

    - name: Create a virtual machine from a template
      community.vmware.vmware_guest:
        hostname: "{{ vcenter_hostname }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        datacenter: SDDC-Datacenter
        folder: /SDDC-Datacenter/vm/Workloads/sandbox-2dqmq
        name: "{{ vm_name }}"
        state: poweredon
        template: /SDDC-Datacenter/vm/Workloads/sandbox-2dqmq/rhel9-tmp
        disk:
        - size_gb: "{{ disk_gb }}"
          datastore: WorkloadDatastore
        hardware:
          memory_mb: 512
          num_cpus: 2
      delegate_to: localhost
      register: deploy
